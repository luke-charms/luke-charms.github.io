<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Interrupt Handling</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
    margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-interactiveBlue { background-color: rgba(35, 131, 226, .07); }
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-translucentGray { background-color: rgba(255, 255, 255, 0.0375); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }
.select-value-color-pageGlass { background-color: undefined; }
.select-value-color-washGlass { background-color: undefined; }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="a48860c9-370c-4dfb-83a3-7af9af027a34" class="page sans"><header><div class="page-header-icon undefined"><img class="icon" src="https://www.notion.so/icons/immigration_orange.svg"/></div><h1 class="page-title">Interrupt Handling</h1><p class="page-description"></p></header><div class="page-body"><nav id="e0cf5195-44c3-46f4-9c56-e9b7d4792988" class="block-color-gray table_of_contents"><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#723f3dd6-f230-4993-ae2f-b4471d6a8095">Basic I/O Methods</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#9d7f11e7-52ba-4f31-b009-ccf4ac13e9af">Program Flow</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#c7b438f8-06d6-4b8e-8415-fbb0025c0104">Interrupts</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#0145678c-63cf-4437-9e71-99ab6fbc2d51">“Precise Interrupt”</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#9483346d-bb21-4778-8ad9-a4cefe5c4ea6">What happens when an Interrupt arrives?</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#d4f81c9e-4980-48a8-bd77-e92d214ebd0f">Interrupt Service Routines (ISR)</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#0c85a3cb-5daa-4240-9cec-8e0b4e4c0acb">Why fast?</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#82c92d81-9004-4d4e-877b-87812178813a">Latency</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#1e27f08d-57cf-4c8c-8726-1b5f26f45ece">Causes of latency</a></div><div class="table_of_contents-item table_of_contents-indent-1"><a class="table_of_contents-link" href="#a9dbb828-f0f5-4d5c-bec8-91a6482a5adc">Jitter</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#fb11d986-8d29-4d0e-b5f8-dc70a5cbcfc3">How do we keep ISRs fast and simple?</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#bee4ae82-389f-4ed2-a21c-23c97181c5a4">ISRs in C</a></div><div class="table_of_contents-item table_of_contents-indent-0"><a class="table_of_contents-link" href="#2eca4e0a-53e0-490e-8b7b-20a7e3972f50">Diagram for Interrupt Handling</a></div></nav><hr id="9c83868a-9f2a-498a-a609-72856c653d57"/><h2 id="723f3dd6-f230-4993-ae2f-b4471d6a8095" class="">Basic I/O Methods</h2><p id="1711e98d-a25e-480e-9404-20f9cbcc61ec" class=""><strong>Programmed I/O (Polling)</strong></p><p id="f3029502-3ed4-4c4b-a000-31c345b86a21" class="">→ CPU sits in a tight loop until input is available or output can be accepted</p><p id="c5514b1f-7803-40ea-9e17-55bccf61cbcb" class="">→ Occupies CPU (”busy waiting”)</p><p id="4ac28300-e8ae-4004-9a37-143647d787a2" class="">→ Very fast reaction possible</p><p id="7dae76af-1720-4009-a812-ab1c1d6445e3" class="">
</p><p id="446a0be6-62bd-4063-9ada-cc5806d28c35" class=""><strong>Interrupt-driven I/O</strong></p><p id="0ed62e78-8c00-46c3-9e94-a80a93c97814" class="">→ Hardware signal can change program flow</p><p id="d5445cb6-1fb1-4cf2-b7b8-b6785cc5b2a6" class="">→ CPU can do other work (or sleep) unless I/O is possible</p><p id="0395bdd3-732c-4e12-a315-3de181f648c9" class="">
</p><figure class="block-color-yellow_background callout" style="white-space:pre-wrap;display:flex" id="004624d7-f429-4b67-9736-d68f9355ffe3"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><em>Other I/O methods like Direct Memory Access (DMA) or dedicated I/O computers (e.g. a graphics card) use interrupts to communicate with the CPU</em></div></figure><h2 id="9d7f11e7-52ba-4f31-b009-ccf4ac13e9af" class="">Program Flow</h2><figure id="5609669e-de38-4642-877f-f2da84423f13" class="image" style="text-align:left"><a href="Interrupt%20Handling%20a48860c9370c4dfb83a37af9af027a34/Screenshot_2023-03-06_at_10.12.01.png"><img style="width:528px" src="Interrupt%20Handling%20a48860c9370c4dfb83a37af9af027a34/Screenshot_2023-03-06_at_10.12.01.png"/></a></figure><p id="7e8be1b0-1573-4f54-848e-26d8d4f354af" class="">Usually end up in an endless loop in microcontroller systems because you have nowhere else to really go</p><p id="07516461-2b5c-4c86-9780-b9c99e1d3ae5" class=""><strong><strong>ISR</strong></strong> usually called when something in software/hardware goes wrong, and can be called at any time!</p><h2 id="c7b438f8-06d6-4b8e-8415-fbb0025c0104" class="">Interrupts</h2><p id="ebfe7552-6240-413a-bb01-2f55fe1a10d1" class="">The solution to overcome the inefficiency of programmed I/O is a possibility to interrupt the CPU when I/O devices are ready to receive or deliver data.</p><figure class="block-color-yellow_background callout" style="white-space:pre-wrap;display:flex" id="17ffbe33-8997-4cc6-b61f-8f62ebef2a3c"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><strong>Important</strong>: the CPU needs to be able to continue where it was interrupted after the interrupt has been dealt with i.e.
<code> </code><code><strong><strong><strong>—&gt; </strong></strong></strong></code><code>State of the interrupted process needs to be preserved</code></div></figure><p id="ea711b07-e81b-45dc-9531-8a34a4c2f95a" class="">(<em><em>Exception: if interrupt should abort execution because of an irrecoverable fault</em></em>)</p><p id="7a94cd40-1b99-4880-bb87-9b37c2f14bf5" class="">
</p><p id="5f83e260-b19b-4009-a243-36127bd73e3a" class=""><style>@import url('https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.2/katex.min.css')</style><span data-token-index="0" contenteditable="false" class="notion-text-equation-token" style="user-select:all;-webkit-user-select:all;-moz-user-select:all"><span></span><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>m</mi><mi>a</mi><mi>g</mi><mi>e</mi><mo>−</mo><mi>a</mi><mi>b</mi><mi>o</mi><mi>v</mi><mi>e</mi><mo>−</mo><mi>a</mi><mi>c</mi><mi>t</mi><mi>u</mi><mi>a</mi><mi>l</mi><mi>l</mi><mi>y</mi><mo>−</mo><mi>b</mi><mi>e</mi><mi>c</mi><mi>o</mi><mi>m</mi><mi>e</mi><mi>s</mi><mo>:</mo></mrow><annotation encoding="application/x-tex">Image-above-actually-becomes:</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal">ma</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">ab</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord mathnormal">u</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">ll</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">b</span><span class="mord mathnormal">eco</span><span class="mord mathnormal">m</span><span class="mord mathnormal">es</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span></span></span></span><span>﻿</span></span></p><figure id="e59ebe7d-dada-4ae0-808d-4f37d3c4faa5" class="image" style="text-align:left"><a href="Interrupt%20Handling%20a48860c9370c4dfb83a37af9af027a34/Screenshot_2023-03-06_at_10.25.48.png"><img style="width:480px" src="Interrupt%20Handling%20a48860c9370c4dfb83a37af9af027a34/Screenshot_2023-03-06_at_10.25.48.png"/></a></figure><h2 id="0145678c-63cf-4437-9e71-99ab6fbc2d51" class="">“Precise Interrupt”</h2><p id="3236acbd-c95b-4f43-8de2-4c5a6a7b8890" class="">1. State of program counter (PC) is preserved</p><p id="2b024071-9da7-447b-a609-b881d8ddc4b8" class="">2. Everything before PC has been fully executed</p><p id="2a600018-8c7a-423d-b7c1-390d51362fe9" class="">3. Nothing beyond the PC has been started</p><p id="adecdbf1-bff8-4225-b7c5-329857f330c4" class="">4. Execution state of instruction at the PC is known</p><h2 id="9483346d-bb21-4778-8ad9-a4cefe5c4ea6" class="">What happens when an Interrupt arrives?</h2><p id="8fa5645a-ae08-445e-8e8d-30967b6ce626" class="">→ Processor completes current instruction</p><p id="07c9caa9-26fc-4d4d-adf2-4c79416e671c" class="">→ Processor acknowledges interrupt</p><p id="ae433254-d371-4740-a206-47a4282bb3be" class="">→ Hardware saves some state:<div class="indented"><p id="c125a961-5af6-446b-8acb-e9d6a8e3fca8" class="">→ Program counter (PC)</p><p id="acb00944-936f-47fd-94b9-d6cf0f0d7d3c" class="">→ Process status word (PSW)</p></div></p><p id="912bdc7d-3075-4519-a390-bd768c1e3f22" class="">→ PC register is loaded with value from interrupt vector table</p><p id="b9f95afd-0980-4840-bb4a-0f2b4465d077" class=""><strong>(</strong><strong><em><em>Control now handed to software)</em></em></strong></p><p id="f89f8599-8a4a-48d7-b2e9-0a6121773b4f" class="">→ Software disables interrupts</p><p id="113116b0-d431-42d6-a452-a26551c18f03" class="">→ Saves additional state<div class="indented"><p id="049270d3-dcd0-4b01-afa4-475570c30325" class="">→ Registers —&gt; Stack</p></div></p><p id="6639b6b0-4ef0-4965-b6b8-c2339cdc8bac" class="">→ May reenable interrupts<div class="indented"><p id="1dfe943c-724e-4d09-9258-5285b60c7b2a" class="">→ Easier if not enabled</p></div></p><p id="dd4f590a-41bf-456d-bfc7-6ecfae82e4a9" class="">→ Services the interrupt → ISR</p><p id="5de0bc32-2a10-4e84-8a9c-93abedf6694f" class="">→ Restore state (Software)</p><p id="b9dd6e30-5ef3-4bf8-80a8-06f4d159a00c" class="">→ Enable interrupts</p><p id="2b010e07-6fb6-43fd-9393-9f8bdeb1bfa0" class="">→ Hardware: restores PSW and PC</p><h2 id="d4f81c9e-4980-48a8-bd77-e92d214ebd0f" class="">Interrupt Service Routines (ISR)</h2><p id="f769ecd4-efb3-4df3-8973-de8b8adb0a71" class=""><mark class="highlight-orange_background">Procedure that is executed when the interrupt occurs and that handles the interrupt.</mark></p><p id="6fdba507-f7c1-49f5-8911-9ea8c811636d" class=""><strong>Two important rules:</strong></p><p id="abf0bb53-040a-48ce-bc6a-d8181f6d51e8" class=""><strong>1.  </strong><mark class="highlight-red_background"><strong>Keep them fast</strong></mark></p><ul id="4f9ecd9a-3dd1-4fe4-ad40-02f695c55950" class="bulleted-list"><li style="list-style-type:disc">avoid loops</li></ul><ul id="1509cf96-e753-46a8-b4dd-b35724a5e860" class="bulleted-list"><li style="list-style-type:disc">avoid heavy instructions → no <code>printf()</code></li></ul><ul id="d7a70d68-f549-47a3-882b-2b18747964d3" class="bulleted-list"><li style="list-style-type:disc">should not block → no <code>scanf()</code></li></ul><p id="6513fd0a-51ff-4e92-8e03-6025aae107dc" class=""><strong>2. </strong><mark class="highlight-red_background"><strong>Keep them simple</strong></mark></p><ul id="4d90bcba-babe-4517-943e-9e69b52945a7" class="bulleted-list"><li style="list-style-type:disc">debugging ISRs is hard</li></ul><h3 id="0c85a3cb-5daa-4240-9cec-8e0b4e4c0acb" class="">Why fast?</h3><p id="9bc6df29-5dec-4d61-af05-201de70f1f1f" class=""><mark class="highlight-blue_background">If they are fast you can usually block all interrupts:</mark></p><ul id="b4ea9869-2c03-45f8-ab27-a32bbc22b8e5" class="bulleted-list"><li style="list-style-type:disc"><strong>Life is simpler if you do not need to make your ISRs interrupt-able</strong></li></ul><ul id="687acfb5-93ab-4531-b921-82c31fe6b6f3" class="bulleted-list"><li style="list-style-type:disc"><strong>Stack size bounds are simpler to establish </strong>- every time an ISR is called up, ‘stuff’ is added to the stack, so need to know max size that interrupts can add to stack (<em><em><em><em>i.e.</em></em></em></em> don’t call interrupts from interrupts)</li></ul><ul id="e9cc8b48-6b3b-40c4-87f1-8c1d87a26be0" class="bulleted-list"><li style="list-style-type:disc"><strong>No need for reentrant ISRs</strong></li></ul><h2 id="82c92d81-9004-4d4e-877b-87812178813a" class="">Latency</h2><p id="8867ae83-1ac0-4768-8f99-64c648d92313" class=""><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>How long does it take until the CPU can respond?</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></p><p id="84e4bd16-2e13-403f-98ab-604a37dabf73" class=""><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>Is this delay deterministic?</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></p><p id="ee51ef98-0072-4d5d-8a25-277cfdacadf7" class=""><em><em>Deterministic latency may be important in real-time applications: e.g., human operators and also control algorithms can adapt to deterministic latency, but struggle with random delays in control lines. </em></em><div class="indented"><p id="4e1ac86a-4c22-4c75-a209-669e67011156" class="">→ i.e. like when, for example, driving a electric car, if there is delay between pressing pedal and the car then moving, similar delay can be adjusted and normalised to</p></div></p><figure class="block-color-yellow_background callout" style="white-space:pre-wrap;display:flex" id="321a2dbb-fda2-4f7f-b0c4-8c7e8e3d77d0"><div style="font-size:1.5em"><span class="icon">💡</span></div><div style="width:100%"><em>We are often typically interested in maximum latency. We like putting bounds on things!</em></div></figure><h3 id="1e27f08d-57cf-4c8c-8726-1b5f26f45ece" class="">Causes of latency</h3><p id="97d4fb8c-a4f1-45b4-ab67-bd0fc0cec742" class=""><strong>We have latency caused due to hardware:</strong></p><ul id="55ecd62b-34c7-4fbc-bae7-1fcf030e4842" class="bulleted-list"><li style="list-style-type:disc">Current instruction is completed</li></ul><ul id="eeed5d47-18b7-4948-b760-c146b1018483" class="bulleted-list"><li style="list-style-type:disc">Hardware support to save state</li></ul><p id="6562203f-3866-404f-8cc3-45da4e97b62b" class=""><strong>We also have latency caused due to software:</strong></p><ul id="72325744-0c72-47b4-9d95-d6a24db915a1" class="bulleted-list"><li style="list-style-type:disc">Software to save state</li></ul><ul id="443a1180-7ba5-4143-a771-6b5de429a54f" class="bulleted-list"><li style="list-style-type:disc">Maximum length of critical sections that disable interrupts</li></ul><h3 id="a9dbb828-f0f5-4d5c-bec8-91a6482a5adc" class="">Jitter</h3><p id="cf7a1b9e-f840-4986-ac9c-17882a4b615e" class="">What’s the variance in our latency?</p><p id="129454dd-cedc-43de-b6d5-66642efaa580" class="">Some instructions cannot be interrupted <em>(c.f. DMA/CPU halting)</em><div class="indented"><p id="4e929312-9f7a-45c9-8882-dd870a05b429" class="">→ Some instructions take multiple clock cycles, although this is quite low (on AVR there are only two types of instruction: one-cycle and two-cycle)</p><p id="5c0c939b-451e-49d4-aeee-ea7751e7d882" class="">→ The response time depends on the instruction executed when the interrupt arrives</p></div></p><h2 id="fb11d986-8d29-4d0e-b5f8-dc70a5cbcfc3" class="">How do we keep ISRs fast and simple?</h2><p id="19cf9ec2-ae27-40d7-a932-5190979fb88d" class=""><em><strong>Keep Interrupts off during ISR</strong></em></p><p id="fa678312-61e5-4481-af84-295e87077cca" class="">Advantage: </p><p id="2919eff1-b649-400d-9d5f-ec055c68f012" class="">→ <strong>No worries about stack depth</strong></p><p id="092c7675-605a-4d44-b599-907d3e4a52fa" class="">→ <strong>No overhead for reentrant code</strong></p><p id="acf739b6-3937-470a-9523-bdb22bac5411" class="">Disadvantage:</p><p id="fb5b44b5-c49c-466a-8177-08a5685a44ee" class="">→ <strong>Latency</strong></p><p id="b447a1d2-a659-45ed-b031-00fc137fd357" class="">→ <strong>Lost interrupts</strong></p><p id="9aeffc6b-e109-48bd-9443-1ed41036b130" class="">HOW?</p><ul id="63820826-19b0-4d77-bc46-709004df9ede" class="bulleted-list"><li style="list-style-type:disc">Move the data that needs processing to some buffer</li></ul><ul id="2cbebd3d-a638-4a8e-a8c8-96146caf5568" class="bulleted-list"><li style="list-style-type:disc">Set a global flag → <mark class="highlight-brown"><code>volatile unit8_t</code></mark></li></ul><ul id="2c7f5f5a-f71c-44c6-b124-df6f9346dd80" class="bulleted-list"><li style="list-style-type:disc">Return immediately</li></ul><ul id="d7ffb828-4eea-4644-8abf-4af2d5b5d70d" class="bulleted-list"><li style="list-style-type:disc">Check the flag in the main loop and do the work there</li></ul><h2 id="bee4ae82-389f-4ed2-a21c-23c97181c5a4" class="">ISRs in C</h2><ul id="fd038796-aa21-4dff-9a2b-b8b1cbcb1ef5" class="bulleted-list"><li style="list-style-type:disc">The C language unfortunately has no support for ISRs</li></ul><ul id="a1231efb-865a-4b24-9184-49e73913f45c" class="bulleted-list"><li style="list-style-type:disc">Declaring ISRs is compiler specific</li></ul><ul id="9121c3ca-feae-4786-abe6-f11998de3343" class="bulleted-list"><li style="list-style-type:disc">C statements are typically compiled into multiple CPU instructions</li></ul><ul id="3ab16544-a61b-4309-87d7-06e07da1f663" class="bulleted-list"><li style="list-style-type:disc"><mark class="highlight-pink_background">C statements can be interrupted!</mark></li></ul><hr id="0a8e9e3a-e0fe-445c-ba52-7f06a0b57e55"/><h2 id="2eca4e0a-53e0-490e-8b7b-20a7e3972f50" class="">Diagram for Interrupt Handling</h2><figure id="6f2ef9c7-90e9-427d-9c9a-9d2e13f4c449" class="image"><a href="Interrupt%20Handling%20a48860c9370c4dfb83a37af9af027a34/witeboard_Interrupt_Handlng.png"><img style="width:624px" src="Interrupt%20Handling%20a48860c9370c4dfb83a37af9af027a34/witeboard_Interrupt_Handlng.png"/></a></figure><p id="49f9f16b-107d-43b1-b6ff-a86b92237205" class="">
</p></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body></html>